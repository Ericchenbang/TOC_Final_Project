<!DOCTYPE html>
<html>
<head>
    <title>Hangman</title>

    <style>
        #hangman-container {
            width: 250px;
            height: 250px;
            border: 2px solid #aaa;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            background-color: #fafafa;
        }

        #hangman-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

    </style>




    <script>
    let gameLocked = false;

    /* ===== Keyboard input ===== */
    document.addEventListener("keydown", function (e) {
        if (gameLocked) return;

        if (!/^[a-zA-Z]$/.test(e.key)) return;

        fetch("/hangman_guess_ajax", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ letter: e.key })
        })
        .then(res => res.json())
        .then(data => {
            if (data.error) return;

            updateGame(data);
        });
    });

    function updateGame(data) {
        document.getElementById("masked").innerText = data.masked;
        document.getElementById("wrong").innerText = data.wrong;
        document.getElementById("guessed").innerText = data.guessed.join(", ");

        document.getElementById("hangman-img").src =
        "/static/hangman/H" + data.wrong + ".png";


        if (data.win) {
            gameLocked = true;
            setTimeout(() => {
                alert("ğŸ‰ You Win! Next word!");
                location.reload();
            }, 700);
        }

        if (data.lose) {
            gameLocked = true;

            setTimeout(() => {
                alert("ğŸ’€ You Lose!\nAnswer: " + data.answer);
                location.reload();
            }, 700);
        }
    }

    /* ===== Hint ===== */
    function useHint() {
        if (gameLocked) return;

        
        fetch("/hangman_hint", {method: "POST"})
        .then(res => res.json())
        .then(data => {
            if (data.error === "hint_used") {
                alert("âš ï¸ Hint can only be used once!");
                return;
            }

            if (!confirm("Using a hint will cost 1 life. Are you sure ?")) return;

            document.getElementById("hint-box").innerText = data.hint;
            document.getElementById("hint-box").style.display = "block";
            document.getElementById("wrong").innerText = data.wrong;
            document.getElementById("hint-btn").disabled = true;

            document.getElementById("hangman-img").src =
            "/static/hangman/H" + data.wrong + ".png";
            

            if (data.lose) {
                alert("ğŸ’€ You Lose!");
                gameLocked = true;
            }
        });
    }
    </script>
</head>
<body>

<h1>Hangman Game</h1>
<div id="hangman-container">
    <img id="hangman-img"
         src="{{ url_for('static', filename='hangman/H' ~ wrong ~ '.png') }}">
</div>


<!-- ===== Hint ===== -->
<button id="hint-btn" onclick="useHint()">ğŸ’¡ Hint (cost 1 life)</button>

<div id="hint-box"
     style="display:none; border:1px solid #aaa; padding:10px; margin:10px 0;">
</div>

<hr>

<!-- ===== Game Display ===== -->
<p><b>Word:</b></p>
<h2 id="masked" style="letter-spacing:8px;">{{ masked }}</h2>

<p>Wrong guesses: <span id="wrong">{{ wrong }}</span> / 6</p>

<p>Guessed letters: <span id="guessed">{{ guessed | join(", ") }}</span></p>

<hr>

<p><i>Type a letter on your keyboard</i></p>

<a href="/hangman">ğŸ” Restart</a> |
<a href="/cloze">ğŸ“ Go to Cloze</a> |
<a href="/">ğŸ  Home</a>



</body>
</html>
