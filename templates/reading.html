<!DOCTYPE html>
<html>
<head>
    <title>Reading Quiz</title>
    <script>
        function validateQuiz() {
            {% for q in questions %}
                {% if q.type == "True_Or_False" %}
                    if (!document.querySelector('input[name="{{ q.id }}"]:checked')) {
                        alert("Please answer all questions before submitting.");
                        return false;
                    }
                {% elif q.type == "Multiple_Answer" %}
                    if (document.querySelectorAll(
                        'input[name="{{ q.id }}"]:checked'
                    ).length === 0) {
                        alert("Please answer all questions before submitting.");
                        return false;
                    }
                {% endif %}
            {% endfor %}
            return true;
        }
        </script>
</head>
<body>

<h1>ðŸ“– Reading Quiz</h1>

<form action="/submit_reading" method="POST" onsubmit="return validateQuiz();">

{% for q in questions %}
    <hr>
    <h3>{{ loop.index }}. {{ q.question }}</h3>

    {% if q.type == "True_Or_False" %}
        {% set correct = q.answer|string|lower %}
        {% set user = result[q.id].user if result else None %}

        {% for val in ["true", "false"] %}
            <label
                {% if result %}
                    {% if val == correct %}
                        style="color:green; font-weight:bold;"
                    {% elif val == user and val != correct %}
                        style="color:red;"
                    {% endif %}
                {% endif %}
            >
                <input type="radio"
                    name="{{ q.id }}"
                    value="{{ val }}"
                    required
                    {% if user == val %}checked{% endif %}
                    {% if result %}disabled{% endif %}>
                {{ val|capitalize }}

                {% if result %}
                    {% if val == correct %} âœ”{% endif %}
                    {% if val == user and val != correct %} âœ˜{% endif %}
                {% endif %}
            </label><br>
        {% endfor %}
    {% elif q.type == "Multiple_Answer" %}
        {% for c in q.choices %}
            <label
                {% if result %}
                    {% if loop.index0|string in result[q.id].correct %}
                        style="color:green; font-weight:bold;"
                    {% elif loop.index0|string in result[q.id].user %}
                        style="color:red;"
                    {% endif %}
                {% endif %}
            >
                <input type="checkbox"
                        name="{{ q.id }}"
                        value="{{ loop.index0 }}"
                        {% if result and loop.index0|string in result[q.id].user %}checked{% endif %}
                        {% if result %}disabled{% endif %}>
                {{ c }}

                {% if result %}
                    {% if loop.index0|string in result[q.id].correct %}
                        âœ”
                    {% elif loop.index0|string in result[q.id].user %}
                        âœ˜
                    {% endif %}
                {% endif %}
            </label><br>

        {% endfor %}
    {% endif %}

    {% if result %}
        {% if result[q.id].is_correct %}
            <p style="color:green;">âœ” Correct</p>
        {% else %}
            <p style="color:red;">âœ˜ Incorrect</p>
        {% endif %}
        <p><i>{{ result[q.id].explanation }}</i></p>
    {% endif %}
    
{% endfor %}

<br>

{% if not result %}
    <button type="submit">Submit Quiz</button>
{% else %}
    <p><b>ðŸ”’ Quiz submitted</b></p>
{% endif %}

</form>

<hr>

<a href="{{ url_for(
    'news_detail',
    category=session['current_article_category'],
    article_id=session['current_article_id']
) }}">
â¬… Back to Article
</a>

</body>
</html>
